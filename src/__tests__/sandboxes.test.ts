/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import { expect, test } from "vitest";
import { Vercel } from "../index.js";
import { RunCommandResponseBody } from "../models/runcommandop.js";
import { filesToByteArray, streamToByteArray } from "./files.js";
import { createTestHTTPClient } from "./testclient.js";

test("Sandboxes List Sandboxes", async () => {
  const testHttpClient = createTestHTTPClient("listSandboxes");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.listSandboxes({
    project: "prj_abc123",
    limit: 20,
    since: 1540095775941,
    until: 1540095775951,
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    sandboxes: [],
    pagination: {
      total: 3903.28,
      count: 20,
      next: 1540095775951,
      prev: 1540095775951,
    },
  });
});

test("Sandboxes List Snapshots", async () => {
  const testHttpClient = createTestHTTPClient("listSnapshots");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.listSnapshots({
    project: "prj_abc123",
    limit: 20,
    since: 1540095775941,
    until: 1540095775951,
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    snapshots: [
      {
        id: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
        sourceSandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
        region: "iad1",
        status: "created",
        sizeBytes: 104857600,
        expiresAt: 1750344501629,
        createdAt: 1750344501629,
        updatedAt: 1750344501629,
      },
    ],
    pagination: {
      total: 9335.55,
      count: 20,
      next: 1540095775951,
      prev: 1540095775951,
    },
  });
});

test("Sandboxes Get Sandbox", async () => {
  const testHttpClient = createTestHTTPClient("getSandbox");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.getSandbox({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    sandbox: {
      id: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      memory: 2048,
      vcpus: 2,
      region: "iad1",
      runtime: "node22",
      timeout: 3600000,
      status: "running",
      requestedAt: 1750344501629,
      startedAt: 1750344501629,
      cwd: "/vercel/sandbox",
      requestedStopAt: 1750344501629,
      stoppedAt: 1750344501629,
      abortedAt: 1750344501629,
      duration: 3600000,
      sourceSnapshotId: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      snapshottedAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
      networkPolicy: {
        mode: "custom",
        allowedDomains: [
          "api.vercel.com",
          "*.example.com",
        ],
        allowedCIDRs: [
          "10.0.0.0/8",
        ],
        deniedCIDRs: [
          "10.0.0.0/8",
        ],
        injectionRules: [
          {
            domain: "api.vercel.com",
            headerNames: [
              "Authorization",
              "X-API-Key",
            ],
          },
        ],
      },
    },
    routes: [],
  });
});

test("Sandboxes List Commands", async () => {
  const testHttpClient = createTestHTTPClient("listCommands");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.listCommands({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    commands: [
      {
        id: "cmd_123a6c5209bc3778245d011443644c8d27dc2c50",
        name: "npm",
        args: [
          "run",
          "build",
        ],
        cwd: "/vercel/sandbox",
        sandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
        exitCode: 0,
        startedAt: 1673123456789,
      },
    ],
  });
});

test("Sandboxes Run Command", async () => {
  const testHttpClient = createTestHTTPClient("runCommand");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.runCommand({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      command: "npm",
      args: [
        "install",
        "--save",
        "lodash",
      ],
      cwd: "/home/vercel-sandbox",
      env: {
        "DEBUG": "true",
        "NODE_ENV": "production",
      },
    },
  });
  expect(result).toBeDefined();
  expect(result as RunCommandResponseBody).toEqual({
    command: {
      id: "cmd_123a6c5209bc3778245d011443644c8d27dc2c50",
      name: "npm",
      args: [
        "run",
        "build",
      ],
      cwd: "/vercel/sandbox",
      sandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      exitCode: 0,
      startedAt: 1673123456789,
    },
  });
});

test("Sandboxes Kill Command", async () => {
  const testHttpClient = createTestHTTPClient("killCommand");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.killCommand({
    cmdId: "cmd_abc123",
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      signal: 15,
    },
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    command: {
      id: "cmd_123a6c5209bc3778245d011443644c8d27dc2c50",
      name: "npm",
      args: [
        "run",
        "build",
      ],
      cwd: "/vercel/sandbox",
      sandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      exitCode: 0,
      startedAt: 1673123456789,
    },
  });
});

test("Sandboxes Stop Sandbox", async () => {
  const testHttpClient = createTestHTTPClient("stopSandbox");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.stopSandbox({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    sandbox: {
      id: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      memory: 2048,
      vcpus: 2,
      region: "iad1",
      runtime: "node22",
      timeout: 3600000,
      status: "running",
      requestedAt: 1750344501629,
      startedAt: 1750344501629,
      cwd: "/vercel/sandbox",
      requestedStopAt: 1750344501629,
      stoppedAt: 1750344501629,
      abortedAt: 1750344501629,
      duration: 3600000,
      sourceSnapshotId: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      snapshottedAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
      networkPolicy: {
        mode: "custom",
        allowedDomains: [
          "api.vercel.com",
          "*.example.com",
        ],
        allowedCIDRs: [
          "10.0.0.0/8",
        ],
        deniedCIDRs: [
          "10.0.0.0/8",
        ],
        injectionRules: [
          {
            domain: "api.vercel.com",
            headerNames: [
              "Authorization",
              "X-API-Key",
            ],
          },
        ],
      },
    },
  });
});

test("Sandboxes Extend Sandbox Timeout", async () => {
  const testHttpClient = createTestHTTPClient("extendSandboxTimeout");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.extendSandboxTimeout({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      duration: 300000,
    },
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    sandbox: {
      id: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      memory: 2048,
      vcpus: 2,
      region: "iad1",
      runtime: "node22",
      timeout: 3600000,
      status: "running",
      requestedAt: 1750344501629,
      startedAt: 1750344501629,
      cwd: "/vercel/sandbox",
      requestedStopAt: 1750344501629,
      stoppedAt: 1750344501629,
      abortedAt: 1750344501629,
      duration: 3600000,
      sourceSnapshotId: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      snapshottedAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
      networkPolicy: {
        mode: "custom",
        allowedDomains: [
          "api.vercel.com",
          "*.example.com",
        ],
        allowedCIDRs: [
          "10.0.0.0/8",
        ],
        deniedCIDRs: [
          "10.0.0.0/8",
        ],
        injectionRules: [
          {
            domain: "api.vercel.com",
            headerNames: [
              "Authorization",
              "X-API-Key",
            ],
          },
        ],
      },
    },
  });
});

test("Sandboxes Update Network Policy", async () => {
  const testHttpClient = createTestHTTPClient("updateNetworkPolicy");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.updateNetworkPolicy({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      mode: "custom",
      allowedDomains: [
        "api.github.com",
        "*.npmjs.org",
      ],
      allowedCIDRs: [
        "35.192.0.0/12",
        "104.16.0.0/12",
      ],
      deniedCIDRs: [
        "35.192.0.0/12",
      ],
    },
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    sandbox: {
      id: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      memory: 2048,
      vcpus: 2,
      region: "iad1",
      runtime: "node22",
      timeout: 3600000,
      status: "running",
      requestedAt: 1750344501629,
      startedAt: 1750344501629,
      cwd: "/vercel/sandbox",
      requestedStopAt: 1750344501629,
      stoppedAt: 1750344501629,
      abortedAt: 1750344501629,
      duration: 3600000,
      sourceSnapshotId: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      snapshottedAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
      networkPolicy: {
        mode: "custom",
        allowedDomains: [
          "api.vercel.com",
          "*.example.com",
        ],
        allowedCIDRs: [
          "10.0.0.0/8",
        ],
        deniedCIDRs: [
          "10.0.0.0/8",
        ],
        injectionRules: [
          {
            domain: "api.vercel.com",
            headerNames: [
              "Authorization",
              "X-API-Key",
            ],
          },
        ],
      },
    },
  });
});

test("Sandboxes Get Command", async () => {
  const testHttpClient = createTestHTTPClient("getCommand");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.getCommand({
    sandboxId: "sbx_abc123",
    cmdId: "cmd_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    command: {
      id: "cmd_123a6c5209bc3778245d011443644c8d27dc2c50",
      name: "npm",
      args: [
        "run",
        "build",
      ],
      cwd: "/vercel/sandbox",
      sandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      exitCode: 0,
      startedAt: 1673123456789,
    },
  });
});

test("Sandboxes Read File", async () => {
  const testHttpClient = createTestHTTPClient("readFile");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.readFile({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      cwd: "/home/vercel-sandbox",
      path: "dist/agent-output.md",
    },
  });
  expect(result).toBeDefined();
  expect(new Uint8Array(await streamToByteArray(result))).toEqual(
    await filesToByteArray(".speakeasy/testfiles/example.file"),
  );
});

test("Sandboxes Create Directory", async () => {
  const testHttpClient = createTestHTTPClient("createDirectory");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.createDirectory({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
    requestBody: {
      cwd: "/home/vercel-sandbox",
      path: "src/components",
    },
  });
  expect(result).toBeDefined();
  expect(result).toEqual({});
});

test("Sandboxes Write Files", async () => {
  const testHttpClient = createTestHTTPClient("writeFiles");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.writeFiles({
    xCwd: "/home/vercel-sandbox",
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({});
});

test("Sandboxes Get Snapshot", async () => {
  const testHttpClient = createTestHTTPClient("getSnapshot");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.getSnapshot({
    snapshotId: "snap_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    snapshot: {
      id: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      sourceSandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      region: "iad1",
      status: "created",
      sizeBytes: 104857600,
      expiresAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
    },
  });
});

test("Sandboxes Delete Snapshot", async () => {
  const testHttpClient = createTestHTTPClient("deleteSnapshot");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.deleteSnapshot({
    snapshotId: "snap_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    snapshot: {
      id: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      sourceSandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      region: "iad1",
      status: "created",
      sizeBytes: 104857600,
      expiresAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
    },
  });
});

test("Sandboxes Create Snapshot", async () => {
  const testHttpClient = createTestHTTPClient("createSnapshot");

  const vercel = new Vercel({
    serverURL: process.env["TEST_SERVER_URL"] ?? "http://localhost:18080",
    httpClient: testHttpClient,
    bearerToken: "<YOUR_BEARER_TOKEN_HERE>",
  });

  const result = await vercel.sandboxes.createSnapshot({
    sandboxId: "sbx_abc123",
    teamId: "team_1a2b3c4d5e6f7g8h9i0j1k2l",
    slug: "my-team-url-slug",
  });
  expect(result).toBeDefined();
  expect(result).toEqual({
    snapshot: {
      id: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      sourceSandboxId: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      region: "iad1",
      status: "created",
      sizeBytes: 104857600,
      expiresAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
    },
    sandbox: {
      id: "sbx_123a6c5209bc3778245d011443644c8d27dc2c50",
      memory: 2048,
      vcpus: 2,
      region: "iad1",
      runtime: "node22",
      timeout: 3600000,
      status: "running",
      requestedAt: 1750344501629,
      startedAt: 1750344501629,
      cwd: "/vercel/sandbox",
      requestedStopAt: 1750344501629,
      stoppedAt: 1750344501629,
      abortedAt: 1750344501629,
      duration: 3600000,
      sourceSnapshotId: "snap_123a6c5209bc3778245d011443644c8d27dc2c50",
      snapshottedAt: 1750344501629,
      createdAt: 1750344501629,
      updatedAt: 1750344501629,
      networkPolicy: {
        mode: "custom",
        allowedDomains: [
          "api.vercel.com",
          "*.example.com",
        ],
        allowedCIDRs: [
          "10.0.0.0/8",
        ],
        deniedCIDRs: [
          "10.0.0.0/8",
        ],
        injectionRules: [
          {
            domain: "api.vercel.com",
            headerNames: [
              "Authorization",
              "X-API-Key",
            ],
          },
        ],
      },
    },
  });
});
